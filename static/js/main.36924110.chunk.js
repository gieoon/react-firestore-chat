(this["webpackJsonpreact-firestore-chat-example"]=this["webpackJsonpreact-firestore-chat-example"]||[]).push([[0],{16:function(e,t,a){e.exports=a(36)},17:function(e,t,a){},35:function(e,t,a){},36:function(e,t,a){"use strict";a.r(t);a(17);var s=a(1),r=a.n(s),c=a(14),n=a.n(c),o=a(12),_=a.n(o),l=a(15),d=a(8),i=a(7),m=a(10),u=a.n(m),h={root:"_styles-module__root___Q-W2",chat_wrapper:"_styles-module__chat_wrapper__3bztd",chat_wrapper_inner:"_styles-module__chat_wrapper_inner__33CZp",chat_wrapper_users:"_styles-module__chat_wrapper_users__15Ugn",chat_user:"_styles-module__chat_user__2m_AP",username:"_styles-module__username__3igkT",chat_wrapper_messages:"_styles-module__chat_wrapper_messages__1kgYW",ma_message_wrapper:"_styles-module__ma_message_wrapper__3PZZP",ma_header_area:"_styles-module__ma_header_area__3aS3w",ma_header_link:"_styles-module__ma_header_link__1gGJB",ma_header_username:"_styles-module__ma_header_username__1q2WU",ma_header_nickname:"_styles-module__ma_header_nickname__3ADPa",ma_header_location:"_styles-module__ma_header_location__2b_nh",ma_message_area:"_styles-module__ma_message_area__236xH",ma_input_area:"_styles-module__ma_input_area__3nWde",chatHeader:"_styles-module__chatHeader__23UA6",chatHeader_startOfChat:"_styles-module__chatHeader_startOfChat__1Sk2d",chatForm:"_styles-module__chatForm__1Ryxl",active:"_styles-module__active__3sodH",chatForm_inner:"_styles-module__chatForm_inner__1InB3",chatBottom:"_styles-module__chatBottom__Oj7Cf",chat_unread:"_styles-module__chat_unread__1QBMl",chat_unreadTag:"_styles-module__chat_unreadTag__2wsRI",chatUser_container:"_styles-module__chatUser_container__b2D1W",chat_user_unread:"_styles-module__chat_user_unread__3WFzM",growBtn:"_styles-module__growBtn__2ocmI",msgArea_contents:"_styles-module__msgArea_contents__iw4Tj",showing:"_styles-module__showing__3PU41",msgArea_contents_inner:"_styles-module__msgArea_contents_inner__2MGuk",chatBoxTimeSeparator:"_styles-module__chatBoxTimeSeparator__18Iuz",msgArea_contents_inner_button_container:"_styles-module__msgArea_contents_inner_button_container__1er00",msgArea_contents_inner_button:"_styles-module__msgArea_contents_inner_button__3Kq88",chatBox:"_styles-module__chatBox__2-N0g",self_send:"_styles-module__self_send__as-GQ",chatBox_msg_time:"_styles-module__chatBox_msg_time__3GBEl",soft:"_styles-module__soft__1_g-x"};var p=e=>g[e].ENGLISH;const g={C_SEND:{ENGLISH:"Send",CHINESE:"Send"},START_OF_CHAT:{ENGLISH:"This is the start of your chat with "}},f=e=>{const t=new Date(parseInt(e+"000")).toString().split(" ");return t[1]+" "+t[2]},y="Chats"+5..toString(),E="Users"+5..toString(),v="Messages"+5..toString(),b="Chats"+5..toString();var I={};const C=Object(s.forwardRef)((e,t)=>{const a=Object(s.useRef)(),c=Object(s.useState)(!1),n=Object(i.a)(c,2),o=(n[0],n[1],Object(s.useState)({})),m=Object(i.a)(o,2),p=m[0],g=m[1],f=Object(s.useState)(""),C=Object(i.a)(f,2),k=C[0],S=(C[1],Object(s.useState)({})),j=Object(i.a)(S,2),x=j[0],O=j[1],B=Object(s.useState)(""),N=Object(i.a)(B,2),A=N[0],F=N[1],T=Object(s.useState)({}),U=Object(i.a)(T,2),R=U[0],H=U[1],D=Object(s.useRef)(null);Object(s.useEffect)(()=>{u.a.initializeApp(e.firebaseConfig),I=u.a.firestore(),M(I)},[]),Object(s.useEffect)(()=>{z()},[p]);const M=t=>t.collection(E).doc(e.userId).collection(b).onSnapshot(e=>{e.docChanges().forEach(e=>{"added"===e.type?(console.log("detected user's chat: ",e.doc.id),P(e.doc.get("chatPath"),t)):"modified"===e.type&&console.log("detected modified chat: ",e.doc.id)})}),P=(e,t)=>{const a=e.id;t.doc(e.path).onSnapshot(e=>{const a=G(e.data());L(a,t).then(t=>{const s=Object(d.a)({},R);s[a]=Object(d.a)(Object(d.a)({},t),{},{chatId:e.id}),H(s),Object.keys(x).length||O(Object(d.a)(Object(d.a)({},t),{},{chatId:e.id})),F(e.id)})}),t.doc(e.path).collection(v).orderBy("createdDate","asc").onSnapshot(e=>{e.docChanges().forEach(e=>{if("added"===e.type||"modified"===e.type){if(!e.doc.get("createdDate"))return;console.log("detected message: ",e.type,e.doc.id,e.doc.data());const t=p;t[a]||(t[a]=[]),t[a].push(e.doc.data()),g(Object(d.a)({},t))}})})},z=()=>{window.requestAnimationFrame((function(){const e=document.getElementById(h.ma_message_area);window.setTimeout(()=>{e.scrollTop=e.scrollHeight},500)}))},L=function(){var e=Object(l.a)(_.a.mark((function e(t,a){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.collection(E).doc(t).get().then(e=>e.data()).catch(e=>console.error("Error retrieving user details: ",e)));case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),G=t=>t.participant1===e.userId?t.participant2:t.participant1;Object(s.useImperativeHandle)(t,()=>({createNewChatMessage:J}));const J=(e,t)=>{console.log("creating new chat message"),I.collection(y).add({participant1:e,participant2:t,participant1UnreadIndex:1,participant2UnreadIndex:1}).then(a=>{I.collection(E).doc(e).collection(b).add({chatPath:a}),I.collection(E).doc(t).collection(b).add({chatPath:a})}).catch(e=>console.error("Error creating new chat messsage: ",e))};return r.a.createElement("div",{style:{backgroundColor:e.backgroundColor,color:e.textColor},className:h.chat_wrapper,onClick:()=>{}},r.a.createElement("div",{id:h.chat_wrapper_inner},r.a.createElement("div",{id:h.chat_wrapper_users},Object.values(R).map((e,t)=>r.a.createElement("div",{key:"chat-user-"+t,className:h.chat_user,onClick:t=>{((e,t,a)=>{console.log("user selected: ",e,t,a),O(a),F(a.chatId)})(t,void 0,e)}},r.a.createElement("img",{src:e.photoUrl,alt:""}),r.a.createElement("span",{className:h.username},e.username)))),r.a.createElement(w,{userId:e.userId,selectedUser:x,allMessages:p,msgRef:a,styles:h,selectedUserId:k,chatFormRef:D,chatId:A})))});function w({userId:e,selectedUser:t,allMessages:a,styles:s,chatFormRef:c,chatId:n}){return r.a.createElement("div",{id:s.ma_message_wrapper},r.a.createElement(k,{selectedUser:t}),r.a.createElement(S,{messages:a[t.chatId]||[],selectedUser:t,userId:e}),r.a.createElement("div",{id:s.ma_input_area},r.a.createElement(x,{chatFormRef:c}),r.a.createElement(O,{userId:e,selectedUser:t,f_sendMsg:()=>{console.log("chatid: ",n);var t=c.current.firstChild.value;I.collection(y).doc(n).collection(v).add({text:t,author:e,createdDate:u.a.firestore.FieldValue.serverTimestamp()}).then(()=>{console.log("Message sent successfully"),c.current.firstChild.value=""}).catch(e=>console.error("Error sending message"))},chatFormRef:c})))}function k({selectedUser:e}){return r.a.createElement("a",{href:"../user/"+e.nickname,id:h.ma_header_link},r.a.createElement("div",{id:h.ma_header_area},r.a.createElement("span",{id:h.ma_header_username},e.username),r.a.createElement("span",{id:h.ma_header_nickname},e.nickname),r.a.createElement("br",null),r.a.createElement("span",{id:h.ma_header_location},e.location)))}function S({messages:e,selectedUser:t,userId:a}){var s="";return r.a.createElement("div",{id:h.ma_message_area},(e.length,r.a.createElement("div",{className:h.chatHeader},r.a.createElement("span",{className:h.chatHeader_startOfChat},p("START_OF_CHAT")," ",t.username))),r.a.createElement("div",{className:"chatArea"},e.map((e,c)=>{var n,o;return r.a.createElement("div",{key:c},s!==f(null===(n=e.createdDate)||void 0===n?void 0:n.seconds)?r.a.createElement("span",{className:h.chatBoxTimeSeparator},s=f(null===(o=e.createdDate)||void 0===o?void 0:o.seconds)):"",r.a.createElement(j,{userId:a,m:e,selectedUser:t,index:c,key:"chat-message-"+c}),"))")})))}class j extends r.a.Component{constructor(e){super(e),this.state={userId:e.userId,m:e.m,selectedUser:e.selectedUser,index:e.index,unreadIndex:0,loading:!1}}render(){var e;return r.a.createElement("div",null,r.a.createElement("div",{key:this.state.index,className:"".concat(h.chatBox," ").concat(this.props.m.author===this.props.userId?h.self_send:"")},r.a.createElement("span",{className:this.state.loading?h.soft:""},this.props.m.text," "),this.state.loading?"":r.a.createElement("span",{className:h.chatBox_msg_time}," "+String.fromCharCode("0x2022")+" ",(e=>{if(!e)return"just now";const t=new Date(parseInt(e+"000")).toString().split(" ")[4].split(":");return t[0]+":"+t[1]})(null===(e=this.props.m.createdDate)||void 0===e?void 0:e.seconds)),r.a.createElement("span",{className:"chat-unread "+(this.props.unreadIndex?" chat-unreadTag ":"")})))}}class x extends r.a.Component{constructor(e){super(e),this.chatFormClicked=e=>{const t=this.props.chatFormRef.current;e?t.classList.add(h.active):t.classList.remove(h.active)},this.state={chatFormRef:e.chatFormRef}}render(){return r.a.createElement("div",{className:"".concat(h.chatForm),ref:this.props.chatFormRef,onFocus:()=>{this.chatFormClicked(!0)},onBlur:()=>{this.chatFormClicked(!1)}},r.a.createElement("textarea",{className:"".concat(h.chatForm_inner),placeholder:"Write your message here..."}))}}function O(e){return r.a.createElement("div",{className:h.chatBottom},r.a.createElement("div",{style:{color:"black"}},"feature1, feature2, feature3, Paid feature1, Paid feature2"),r.a.createElement("div",{className:h.msgArea_contents_inner_button_container},r.a.createElement("div",{id:h.ANALYTICS_sendChatMessage,className:h.msgArea_contents_inner_button,onClick:()=>{e.f_sendMsg()}},p("C_SEND"))))}var B=C;a(35);const N={apiKey:"AIzaSyDZOnfAFgXvrABedijrzR42vjhA-Strl1A",authDomain:"speek-5d61f.firebaseapp.com",databaseURL:"https://speek-5d61f.firebaseio.com",projectId:"speek-5d61f",storageBucket:"speek-5d61f.appspot.com",messagingSenderId:"892105399363",appId:"1:892105399363:web:9cc25b318654e31c8a08f6",measurementId:"G-J9322EP1HD"};var A=()=>{const e=r.a.useRef();return r.a.createElement("div",null,r.a.createElement("div",{onClick:()=>{console.log(e),e.current.createNewChatMessage("BQPCTducNBepxzqkVLXICJfvtg12","TmyvTarXsSMzkStJPycd69KYlj03")}},"New Message"),r.a.createElement(B,{firebaseConfig:N,userId:"BQPCTducNBepxzqkVLXICJfvtg12",textColor:"white",backgroundColor:"#EB2764",ref:e}))};n.a.render(r.a.createElement(A,null),document.getElementById("root"))}},[[16,1,2]]]);
//# sourceMappingURL=main.36924110.chunk.js.map